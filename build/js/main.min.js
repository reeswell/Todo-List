var util=function(){var t="GTD";return{fetch:function(){return JSON.parse(localStorage.getItem(t))},save:function(e){return localStorage.setItem(t,JSON.stringify(e))},read:function(){return JSON.parse(localStorage.getItem(t))},mixin:function(t,e){for(var n in e)n in t||(t[n]=e[n]);return t},htmlTranslate:function(t){var e=document.createElement("div");return e.innerHTML=t,e.children[0]},addClass:function(t,e){var n=t.className||"";-1===n.indexOf(e)&&(t.className=n?n+" "+e:e)},removeClass:function(t,e){var n=t.className;if(!n)return!1;t.className=(" "+n+" ").replace(" "+e+" "," ").trim()},getStyle:function(t,e){return window.getComputedStyle?getComputedStyle(t,"")[e]:t.currentStyle[e]},addEvent:function(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n},removeEvent:function(t,e,n){t.removeEventListener?t.removeEventListener(e,n):t.detachEvent?t.detachEvent("on"+e,n):t["on"+e]=null},emitter:{on:function(t,e){var n=this._handles||(this._handles={});return(n[t]||(n[t]=[])).push(e),this},off:function(t,e){if(t&&this._handles){var n,i=this._handles;if((n=i[t])&&!e)return i[t]=[],this;for(var o=0,s=n.length;o<s;o++)if(e===n[o])return n.splice(o,1),this;return this}},emit:function(t){var e,n=Array.prototype.slice.call(arguments,1),i=this._handles;if(!i||!(e=i[t]))return this;for(var o=0,s=e.length;o<s;o++)e[o].apply(this,n);return this}}}}();!function(t){function e(e){return this.options=e||{},this.container=this.layout.cloneNode(!0),this.body=this.container.querySelector(".new-title"),this.bodyContent=this.container.querySelector(".new-title h3"),this.input=this.body.querySelector("input"),t.mixin(this,e),this._renderUI(),this._initEvent(),this}t.mixin(e.prototype,{layout:t.htmlTranslate('<div class="overlay">\n         <div class="box">\n            <div class="box-title">\n                <h3>消息提醒</h3>\n                <div class="box-close icon-cross1"></div>\n            </div>\n            <div class="box-main">\n                <div class="new-title">\n                    <h3 class="nameValue">名称：</h3>\n                    <input type="text">\n                </div>\n                <button class="btn2 confirm">确定</button>\n                <button class="btn2 cancel">取消</button>\n            </div>\n        </div> \n    </div>'),appendTo:function(t){t.appendChild(this.container)},show:function(t){this.container.style.display="block"},hide:function(){this.container.style.display="none"},destroy:function(){this.container.parentNode.removeChild(this.container)},_renderUI:function(){!0===this.hasFlag&&(this.input.parentNode.removeChild(this.input),this.text&&(this.bodyContent.innerText=this.text))},_initEvent:function(){t.addEvent(this.container.querySelector(".confirm"),"click",this.onConfirm.bind(this)),t.addEvent(this.container.querySelector(".cancel"),"click",this.onCancel.bind(this))},onConfirm:function(){this.emit("confirm"),this.destroy()},onCancel:function(){this.emit("cancel"),this.destroy()}}),t.mixin(e.prototype,t.emitter),window.Modal=e}(util),function(t){function e(e){return this.options=e||{},this.canDelete=!0,this.container=this.layout.cloneNode(!0),this.category=this.container.querySelector(".category"),this.category.widget=this,this.cgName=this.container.querySelector(".category .name"),this.number=this.container.querySelector(".number i"),this.cgDelete=this.container.querySelector(".category .delete-i"),this.cgSubclass=this.container.querySelector(".subclass"),t.mixin(this,e),this.renderUI(),this}function n(e){return this.options=e||{},this.container=this.layout.cloneNode(!0),this.container.widget=this,this.scName=this.container.querySelector(".name"),this.scNumber=this.container.querySelector(".number i"),this.scgDelete=this.container.querySelector(".delete-i"),t.mixin(this,e),this.renderUI(),this}t.mixin(e.prototype,{layout:t.htmlTranslate('<li> \n        <div class="category cg"> \n            <i class="icon-folder-open"></i> \n            <span class="name">默认分类</span> \n            <span class="number">(<i>0</i>)</span> \n            <i class="icon-cross1 delete-i"></i> \n        </div> \n        <div class="subclass"> \n        </div> \n      </li>'),setContent:function(t){this.cgName.innerText=t.name,this.number.innerText=t.number},countNumber:function(){var t=this.cgSubclass.querySelectorAll(".subclass .number i"),e=0;if(t.length>0){for(var n=0,i=t.length;n<i;n++)e+=Number(t[n].innerText);this.number.innerText=e}},addSubClass:function(t){this.cgSubclass.appendChild(new n(t).container)},deleteSc:function(){this.container.parentNode.removeChild(this.container)},cgDelete:function(){this.emit("delete")},renderUI:function(){this.name&&this.setContent(this.options),!1===this.options.canDelete&&this.category.removeChild(this.cgDelete)}}),t.mixin(n.prototype,{layout:t.htmlTranslate('<div class="sub-category cg"><i class="icon-folder-o"></i></span><span class="name">task1</span><span class="number">(<i>0</i>)</span><i class="icon-cross1 delete-i"></i></div>'),setContent:function(t){this.scName.innerText=t.name,this.scNumber.innerText=t.number},addBrother:function(){this.container.parentNode.insertBefore(new n({name:name}).container,this.container.nextElementSibling)},deleteSc:function(){this.container.parentNode.removeChild(this.container)},renderUI:function(){this.name&&this.setContent(this.options)},onDelete:function(){this.emit("delete")}}),t.mixin(e.prototype,t.emitter),t.mixin(n.prototype,t.emitter),window.Category=e,window.SubCategory=n}(util),function(t){function e(e){return this.options=e||{},this.container=this._layout.cloneNode(!0),this.taskDate=this.container.querySelector(".date"),this.taskDate.widget=this,this.taskWrap=this.container.querySelector(".wrap"),t.mixin(this,e),this._renderUI(),this}function n(e){return this.options=e||{},this.container=this._layout.cloneNode(!0),this.container.widget=this,t.mixin(this,e),this._renderUI(),this}t.mixin(e.prototype,{_layout:t.htmlTranslate('<li> \n        <div class="date"></div> \n        <div class="wrap"> \n        </div> \n    </li>'),setContent:function(t){this.taskDate.innerText=t,this.taskDate.id="id"+t},addTodo:function(t){this.todo=new n(t).container,this.taskWrap.appendChild(this.todo)},_renderUI:function(){this.date&&this.setContent(this.date),this.name&&this.addTodo(this.options)}}),t.mixin(n.prototype,{_layout:t.htmlTranslate('<div class="todo"></div>'),_renderUI:function(){this.date&&this.container.setAttribute("data-date",this.date),this.name&&(this.container.innerText=this.name,this.container.setAttribute("data-name",this.name)),!0===this.isFinished&&t.addClass(this.container,"z-finished"),this.container.setAttribute("data-isFinished",this.isFinished),this.content&&this.container.setAttribute("data-content",this.content)}}),window.Task=e,window.Todo=n}(util),function(t){function e(e){return this.options=e||{},this.container=this.layout.cloneNode(!0),this.container.widget=this,this.taskName=this.container.querySelector(".head-title .name"),this.finishBtn=this.container.querySelector(".head-icon .finish"),this.editBtn=this.container.querySelector(".head-icon .edit"),this.taskDate=this.container.querySelector(".head-data p"),this.taskContent=this.container.querySelector(".task-content p"),t.mixin(this,e),this.renderUI(),this.initEvent(),this}function n(e){this.options=e||{},this.container=this.layout.cloneNode(!0),this.container.widget=this,this.title=this.container.querySelector(".head-title input"),this.titleTip=this.container.querySelector(".head-title .tips"),this.dateInput=this.container.querySelector(".head-data input"),this.dateTip=this.container.querySelector(".head-data .tips"),this.inputContent=this.container.querySelector(".task-content .contentValue"),this.contentTip=this.container.querySelector("task-content .tips"),this.confirm=this.container.querySelector(".task-content .yes"),this.cancel=this.container.querySelector(".task-content .no"),t.mixin(this,e),this.renderUI(),this.initEvent()}t.mixin(e.prototype,{layout:t.htmlTranslate('<div class="container-right"> \n    <div class="right-head right-head-top"> \n        <div class="head-title"> \n           <p class="name"></p> \n        </div> \n        <div class="head-icon"> \n            <i class="icon-check-circle finish" style="display:none";></i> \n            <i class="icon-edit edit" style="display:none"></i> \n        </div> \n    </div> \n    <div class="right-head"> \n       <div class="head-data"> \n        <p></p> \n       </div> \n   </div> \n   <div class="task-content"> \n    <p></p> \n   </div> \n</div>'),setContent:function(t){this.taskName.innerText=t.name,this.taskDate.innerText=""===t.date?"":"任务日期："+t.date,this.taskContent.innerText=t.content,!1===t.isFinished?this.showBtn():this.hideBtn(),this.editBtn.style.display=""===t.date?"none":"block"},hideBtn:function(){this.finishBtn.style.display="none"},showBtn:function(){this.finishBtn.style.display="block"},reset:function(){this.setContent({name:"",date:"",content:""})},destroy:function(){this.container.parentNode.removeChild(this.container)},getData:function(){var t={};return t.name=this.taskName.innerText,t.date=this.taskDate.innerText.slice(5),t.content=this.taskContent.innerText,t},renderUI:function(){this.name&&this.setContent(this.options)},initEvent:function(){var e=this;t.addEvent(this.finishBtn,"click",(function(t){new Modal({hasFlag:!0,text:"是否确人完成该任务？"}).on("confirm",(function(){e.onFinish()})).appendTo(document.body)})),t.addEvent(this.editBtn,"click",(function(){e.onEdit()}))},onFinish:function(){this.emit("finish")},onEdit:function(){this.emit("edit")}}),t.mixin(n.prototype,{layout:t.htmlTranslate('<div class="container-edit"> \n                 <div class="right-head right-head-top"> \n                     <div class="head-title"> \n                         任务标题：</span><input type="text" class="title-edit" placeholder="在此输入任务标题"><span class="tips"> \n                     </div> \n                 </div> \n                 <div class="right-head"> \n                    <div class="head-data"> \n                        任务日期：</span><input type="text" class="date-edit" placeholder="格式：2015-10-01"><span class="tips"> \n                    </div> \n                </div> \n                <div class="task-content"> \n                    <textarea name="" id="content-edit" class="contentValue"></textarea><span class="tips"> \n                    <button class="btn no">取消</button> \n                    <button class="btn yes">确定</button> \n                </div> \n    </div>'),setContent:function(t){this.title.value=t.name,this.dateInput.value=t.date,this.inputContent.innerText=t.content},getData:function(){var t={};return t.name=this.title.value,t.date=this.dateInput.value,t.content=this.inputContent.value,t.isFinished=!1,t},renderUI:function(){void 0!==this.name&&this.setContent(this.options)},destroy:function(){this.container.parentNode.removeChild(this.container)},checkTitle:function(){return""===this.title.value.trim()?this.titleTip.innerText="名称不能为空":this.titleTip.innerText="",!(""===this.title.value.trim())},checkDate:function(){return""===this.dateInput.value.trim()?this.dateTip.innerText="日期不能为空":this.dateTip.innerText="",!(""===this.dateInput.value.trim())},initEvent:function(){var e=this;t.addEvent(this.title,"blur",(function(t){e.checkTitle()})),t.addEvent(this.dateInput,"blur",(function(t){e.checkDate()})),t.addEvent(this.confirm,"click",(function(t){e.onConfirm()})),t.addEvent(this.cancel,"click",(function(t){e.onCancel()}))},onConfirm:function(){this.emit("confirm"),this.destroy()},onCancel:function(){this.emit("cancel"),this.destroy()}}),t.mixin(e.prototype,t.emitter),t.mixin(n.prototype,t.emitter),window.Detail=e,window.Edit=n}(util),function(t){function e(t){return document.querySelector(t)}function n(t){return t<10?"0"+t:""+t}t.mixin(e,{on:function(t,e,n){return t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent("on"+e,n)},un:function(t,e,n){return t.removeEventListener?t.removeEventListener(e,n,!1):t.detachEvent("on"+e,n)},click:function(t,n){return e.on(t,"click",n)},enter:function(t,n){return e.on(t,"keydown",(function(e){var i=e||window.event;13===(i.which||i.keyCode)&&n.call(t,i)}))},delegate:function(t,n,i,o,s){e.on(t,i,(function(e){for(var i=e||window.event,a=i.target||i.srcElement,r=[],c=t.querySelectorAll(n),d=0;d<c.length;d++)r.push(c[d]);var l=[],h=null;if(void 0!==s){for(h=t.querySelectorAll(s),d=0;d<h.length;d++)l.push(h[d]);if(-1!=l.indexOf(a))return}for(;a!=t;){if(-1!=r.indexOf(a)){o.call(a,e);break}a=a.parentNode}}))}});var i=t.fetch()||{totalNumber:12,category:[{name:"百度IFE项目",number:10,todos:[],subCategory:[{name:"task1",number:6,todos:[{name:"to-do 1",date:"2020-05-08",isFinished:!1,content:"完成任务1"},{name:"to-do 2",date:"2020-05-18",isFinished:!1,content:"完成任务2"},{name:"to-do 3",date:"2020-05-28",isFinished:!0,content:"完成任务3"},{name:"to-do 4",date:"2020-05-18",isFinished:!1,content:"完成任务4"},{name:"to-do 5",date:"2020-05-08",isFinished:!0,content:"完成任务5"},{name:"to-do 6",date:"2020-05-08",isFinished:!1,content:"完成任务6"},{name:"to-do 7",date:"2020-05-11",isFinished:!0,content:"完成任务7"}]},{name:"task2",number:4,todos:[{name:"to-do 1",date:"2015-04-28",isFinished:!1,content:"完成任务1"},{name:"to-do 2",date:"2015-04-29",isFinished:!1,content:"完成任务2"},{name:"to-do 3",date:"2015-04-30",isFinished:!0,content:"完成任务3"}]}]},{name:"毕业设计",number:1,todos:[],subCategory:[]},{name:"社团活动",number:0,todos:[{name:"to-do 1",date:"2020-04-28",isFinished:!0,content:"完成模块一"},{name:"to-do 2",date:"2020-04-08",isFinished:!1,content:"完成模块二"}],subCategory:[]},{name:"家庭生活",number:0,todos:[{name:"to-do 1",date:"2020-04-18",isFinished:!0,content:"打篮球"},{name:"to-do 2",date:"2020-04-18",isFinished:!1,content:"吃饭"}],subCategory:[]},{name:"默认分类",number:1,todos:[{name:"to-do 1",date:"2015-04-08",isFinished:!1,content:"学习"}],subCategory:[]}]},o=e("#total i"),s=e(".category-list"),a=null,r=e(".task-list"),c=e(".list-menu"),d=null,l=e(".addCG"),h=(e(".container"),e(".addTask")),u=e(".list-menu"),m=u.querySelectorAll("li"),f=e(".container-detail"),p=null;function v(t,e){return new Date(t.date)-new Date(e.date)}g(i),w(m[0]);var y=(new Detail).on("finish",(function(){"finished"==p.id&&this.hideBtn();var e=[];if(-1==a.index.indexOf("-"))e=i.category[a.index].todos;else{var n=a.index.split("-");e=i.category[n[0]].subCategory[n[1]].todos}e[d.index].isFinished=!0,g(i),x(i.category,a.index,"all"==p.id?d.index:void 0),t.save(i)})).on("edit",(function(){f.appendChild(new Edit(this.getData()).on("confirm",(function(){var e,n=[],o=this.getData();if(-1==a.index.indexOf("-"))n=i.category[a.index].todos;else{var s=a.index.split("-");n=i.category[s[0]].subCategory[s[1]].todos}var r=n[d.index].isFinished;n[d.index]=o,n[d.index].isFinished=r,n.sort(v),e=n.indexOf(o),b(n,e),t.save(i)})).container)}));function g(t){for(var e=0,n=t.category,i=0;i<n.length;i++){var s=0,a=n[i].subCategory;if(a.length>0){for(var r=0;r<a.length;r++)a[r].number=a[r].todos.length,s+=a[r].number;n[i].number=s+n[i].todos.length,e+=n[i].number}else n[i].number=n[i].todos.length,e+=n[i].number}t.totalNumber=e,o.innerHTML=t.totalNumber}function x(t,e,n){if(s.replaceChild(C(t),s.children[1]),void 0===e)S(document.getElementById("deFault"));else{var i=s.querySelectorAll("li");if(e.indexOf("-")<0)S(i[e].querySelector(".category"),n);else{var o=e.split("-");S(i[o[0]].querySelectorAll(".sub-category")[o[1]],n)}}}function b(t,e){r.replaceChild(function(t){t=function(t){var e=[];if("all"===p.id)for(var n=0;n<t.length;n++)t[n].index=n,e.push(t[n]);else if("unfinished"==p.id)for(n=0;n<t.length;n++)!1===t[n].isFinished&&(t[n].index=n,e.push(t[n]));else for(n=0;n<t.length;n++)!0===t[n].isFinished&&(t[n].index=n,e.push(t[n]));return e}(t);for(var e=document.createElement("ul"),n=null,i=null,o=0;o<t.length;o++){var s=e.querySelector("#id"+t[o].date);null!==s?((i=new Todo(t[o]).container).index=""+t[o].index,s.widget.taskWrap.appendChild(i)):((n=new Task(t[o])).todo.index=""+t[o].index,e.appendChild(n.container))}return e}(t),r.children[0]);var n=r.querySelectorAll(".todo");n.length>0?k(null!=e?e:n[0].index):y.reset()}function C(t){for(var e=document.createElement("ul"),n=null,i=null,o=0;o<t.length;o++){"默认分类"===t[o].name?(n=new Category({name:t[o].name,number:t[o].number,canDelete:!1})).category.id="default":n=new Category({name:t[o].name,number:t[o].number}),n.category.index=""+o;var s=t[o].subCategory;if(s.length>0)for(var a=0;a<s.length;a++)(i=new SubCategory({name:s[a].name,number:s[a].number})).container.index=o+"-"+a,n.cgSubclass.appendChild(i.container);e.appendChild(n.container)}return e}function S(e,n){for(var o=s.querySelectorAll(".cg"),r=0;r<o.length;r++)t.removeClass(o[r],"select");if(t.addClass(e,"select"),a=e,e.index.indexOf("-")<0)b(i.category[e.index].todos,n);else{var c=e.index.split("-");b(i.category[c[0]].subCategory[c[1]].todos,n)}}function k(e){for(var n=r.querySelectorAll(".todo"),o=0;o<n.length;o++)n[o].index==e?(t.addClass(n[o],"select"),d=n[o]):t.removeClass(n[o],"select");var s=[];if(a.index.indexOf("-")<0)s=i.category[a.index].todos;else{var c=a.index.split("-");s=i.category[c[0]].subCategory[c[1]].todos}y.setContent(s[e])}function w(e){for(var n=c.querySelectorAll("li"),i=0;i<n.length;i++)t.removeClass(n[i],"select");t.addClass(e,"select"),p=e}f.appendChild(y.container),e(".container-right"),s.replaceChild(C(i.category),s.children[1]),S(document.getElementById("default")),e.delegate(s,".cg","click",(function(){S(this)}),".delete-i"),e.delegate(u,"li","click",(function(){w(this),x(i.category,a.index)})),e.delegate(r,".todo","click",(function(){k(this.index)})),e.delegate(s,".delete-i","click",(function(){var e=this.parentNode.index,n="";new Modal({hasFlag:!0,text:"是否确定删除？"}).on("confirm",(function(){if(e.indexOf("-")<0)i.category.splice(e,1),n=""+Math.min(e,i.category.length-1);else{var o=e.split("-");i.category[o[0]].subCategory.splice(o[1],1),n=0===i.category[o[0]].subCategory.length?o[0]:o[0]+"-"+Math.min(o[1],i.category[o[0]].subCategory.length-1)}g(i),x(i.category,n),t.save(i)})).appendTo(document.body)})),e.click(l,(function(){(new Modal).on("confirm",(function(){if(""!=this.input.value.trim()){var e="";e=-1!=a.className.indexOf("sub-category")?""+(i.category.push({name:this.input.value,number:0,todos:[],subCategory:[]})-1):a.index+"-"+(i.category[a.index].subCategory.push({name:this.input.value,number:0,todos:[]})-1)}x(i.category,e),t.save(i)})).appendTo(document.body)})),e.click(h,(function(){var e;f.appendChild(new Edit({name:"",date:(e=new Date,e.getFullYear()+"-"+n(e.getMonth()+1)+"-"+n(e.getDate())),content:""}).on("confirm",(function(){var e,n=[],o=this.getData();if(-1==a.index.indexOf("-"))n=i.category[a.index].todos;else{var s=a.index.split("-");n=i.category[s[0]].subCategory[s[1]].todos}n.push(o),n.sort(v),e=n.indexOf(o),g(i),x(i.category,a.index,e),t.save(i)})).container)}))}(util);